"use strict";(self.webpackChunkashu_interface=self.webpackChunkashu_interface||[]).push([[141],{2141:(e,t,n)=>{n.r(t),n.d(t,{default:()=>P});var r=n(5105);const o=(e,t)=>e.unstable_is?e.unstable_is(t):t===e,l=e=>"init"in e,s=e=>!!e.write,a=e=>"v"in e||"e"in e,i=e=>{if("e"in e)throw e.e;if(!("v"in e))throw new Error("[Bug] atom state is not initialized");return e.v},c=Symbol(),d=e=>e[c],u=e=>{var t;return v(e)&&!(null==(t=d(e))?void 0:t[1])},f=(e,t)=>{const n=d(e);if(!n)throw new Error("[Bug] cancelable promise not found");n[1]=!0,n[0].forEach((e=>e(t)))},h=e=>{if(d(e))return;const t=[new Set,!1];e[c]=t;const n=()=>{t[1]=!0};e.then(n,n),e.onCancel=e=>{t[0].add(e)}},v=e=>"function"==typeof(null==e?void 0:e.then),w=(e,t,n)=>{n.p.has(e)||(n.p.add(e),t.then((()=>{n.p.delete(e)}),(()=>{n.p.delete(e)})))},g=(e,t,n)=>{const r=n(e),o="v"in r,l=r.v,s=u(r.v)?r.v:null;if(v(t)){h(t);for(const o of r.d.keys())w(e,t,n(o))}r.v=t,delete r.e,o&&Object.is(l,r.v)||(++r.n,s&&f(s,t))},b=(e,t,n)=>{var r;const o=new Set;for(const t of(null==(r=n.get(e))?void 0:r.t)||[])n.has(t)&&o.add(t);for(const e of t.p)o.add(e);return o},p=()=>{const e={},t=new WeakMap,n=n=>{var r,o;null==(r=t.get(e))||r.forEach((e=>e(n))),null==(o=t.get(n))||o.forEach((e=>e()))};return n.add=(n,r)=>{const o=n||e,l=(t.has(o)?t:t.set(o,new Set)).get(o);return l.add(r),()=>{null==l||l.delete(r),l.size||t.delete(o)}},n},m=Symbol(),y=(e=new WeakMap,t=new WeakMap,n=new WeakMap,r=new Set,c=new Set,d=new Set,f={},h=(e,...t)=>e.read(...t),p=(e,...t)=>e.write(...t),y=(e,t)=>{var n;return null==(n=e.unstable_onInit)?void 0:n.call(e,t)},x=(e,t)=>{var n;return null==(n=e.onMount)?void 0:n.call(e,t)},..._)=>{const k=_[0]||(t=>{if(!t)throw new Error("Atom is undefined or null");let n=e.get(t);return n||(n={d:new Map,p:new Set,n:0},e.set(t,n),null==y||y(t,W)),n}),j=_[1]||(()=>{let e,n;const o=t=>{try{t()}catch(t){e||(e=!0,n=t)}};do{f.f&&o(f.f);const e=new Set,n=e.add.bind(e);r.forEach((e=>{var r;return null==(r=t.get(e))?void 0:r.l.forEach(n)})),r.clear(),d.forEach(n),d.clear(),c.forEach(n),c.clear(),e.forEach(o),r.size&&E()}while(r.size||d.size||c.size);if(e)throw n}),E=_[2]||(()=>{const e=[],o=new WeakSet,l=new WeakSet,s=Array.from(r);for(;s.length;){const r=s[s.length-1],a=k(r);if(l.has(r))s.pop();else if(o.has(r)){if(n.get(r)===a.n)e.push([r,a]);else if(n.has(r))throw new Error("[Bug] invalidated atom exists");l.add(r),s.pop()}else{o.add(r);for(const e of b(r,a,t))o.has(e)||s.push(e)}}for(let t=e.length-1;t>=0;--t){const[o,l]=e[t];let s=!1;for(const e of l.d.keys())if(e!==o&&r.has(e)){s=!0;break}s&&(S(o),A(o)),n.delete(o)}}),S=_[3]||(e=>{var c,d;const b=k(e);if(a(b)){if(t.has(e)&&n.get(e)!==b.n)return b;if(Array.from(b.d).every((([e,t])=>S(e).n===t)))return b}b.d.clear();let p=!0;const m=()=>{t.has(e)&&(A(e),E(),j())},y=n=>{var r;if(o(e,n)){const e=k(n);if(!a(e)){if(!l(n))throw new Error("no atom init");g(n,n.init,k)}return i(e)}const s=S(n);try{return i(s)}finally{b.d.set(n,s.n),u(b.v)&&w(e,b.v,s),null==(r=t.get(n))||r.t.add(e),p||m()}};let x,_;const C={get signal(){return x||(x=new AbortController),x.signal},get setSelf(){return s(e)||console.warn("setSelf function cannot be used with read-only atom"),!_&&s(e)&&(_=(...t)=>{if(p&&console.warn("setSelf function cannot be called in sync"),!p)try{return T(e,...t)}finally{E(),j()}}),_}},N=b.n;try{const t=h(e,y,C);return g(e,t,k),v(t)&&(null==(c=t.onCancel)||c.call(t,(()=>null==x?void 0:x.abort())),t.then(m,m)),b}catch(e){return delete b.v,b.e=e,++b.n,b}finally{p=!1,N!==b.n&&n.get(e)===N&&(n.set(e,b.n),r.add(e),null==(d=f.c)||d.call(f,e))}}),C=_[4]||(e=>{const r=[e];for(;r.length;){const e=r.pop(),o=k(e);for(const l of b(e,o,t)){const e=k(l);n.set(l,e.n),r.push(l)}}}),T=_[5]||((e,...t)=>{let n=!0;const s=e=>i(S(e)),a=(t,...s)=>{var a;const i=k(t);try{if(o(e,t)){if(!l(t))throw new Error("atom not writable");const e=i.n,n=s[0];return g(t,n,k),A(t),void(e!==i.n&&(r.add(t),null==(a=f.c)||a.call(f,t),C(t)))}return T(t,...s)}finally{n||(E(),j())}};try{return p(e,s,a,...t)}finally{n=!1}}),A=_[6]||(e=>{var n;const o=k(e),l=t.get(e);if(l&&!u(o.v)){for(const[t,s]of o.d)if(!l.d.has(t)){const o=k(t);N(t).t.add(e),l.d.add(t),s!==o.n&&(r.add(t),null==(n=f.c)||n.call(f,t),C(t))}for(const t of l.d||[])if(!o.d.has(t)){l.d.delete(t);const n=M(t);null==n||n.t.delete(e)}}}),N=_[7]||(e=>{var n;const r=k(e);let o=t.get(e);if(!o){S(e);for(const t of r.d.keys()){N(t).t.add(e)}if(o={l:new Set,d:new Set(r.d.keys()),t:new Set},t.set(e,o),null==(n=f.m)||n.call(f,e),s(e)){const t=()=>{let t=!0;const n=(...n)=>{try{return T(e,...n)}finally{t||(E(),j())}};try{const r=x(e,n);r&&(o.u=()=>{t=!0;try{r()}finally{t=!1}})}finally{t=!1}};c.add(t)}}return o}),M=_[8]||(e=>{var n;const r=k(e);let o=t.get(e);if(!o||o.l.size||Array.from(o.t).some((n=>{var r;return null==(r=t.get(n))?void 0:r.d.has(e)})))return o;o.u&&d.add(o.u),o=void 0,t.delete(e),null==(n=f.u)||n.call(f,e);for(const t of r.d.keys()){const n=M(t);null==n||n.t.delete(e)}}),O=[e,t,n,r,c,d,f,h,p,y,x,k,j,E,S,C,T,A,N,M],W={get:e=>i(S(e)),set:(e,...t)=>{try{return T(e,...t)}finally{E(),j()}},sub:(e,t)=>{const n=N(e).l;return n.add(t),j(),()=>{n.delete(t),M(e),j()}}};return Object.defineProperty(W,m,{value:O}),W},x=e=>(e.c||(e.c=p()),e.m||(e.m=p()),e.u||(e.u=p()),e.f||(e.f=(()=>{const e=new Set,t=()=>{e.forEach((e=>e()))};return t.add=t=>(e.add(t),()=>{e.delete(t)}),t})()),e);let _=0;function k(e,t){const n="atom"+ ++_,r={toString(){return this.debugLabel?n+":"+this.debugLabel:n}};return"function"==typeof e?r.read=e:(r.init=e,r.read=j,r.write=E),t&&(r.write=t),r}function j(e){return e(this)}function E(e,t,n){return t(this,"function"==typeof n?n(e(this)):n)}const S=()=>(()=>{let e=0;const t=x({}),n=new WeakMap,r=new WeakMap,o=y(n,r,void 0,void 0,void 0,void 0,t,void 0,((t,n,r,...o)=>e?r(t,...o):t.write(n,r,...o))),l=new Set;t.m.add(void 0,(e=>{l.add(e),n.get(e).m=r.get(e)})),t.u.add(void 0,(e=>{l.delete(e),delete n.get(e).m}));const s={dev4_get_internal_weak_map:()=>n,dev4_get_mounted_atoms:()=>l,dev4_restore_atoms:t=>{const n={read:()=>null,write:(n,r)=>{++e;try{for(const[e,n]of t)"init"in e&&r(e,n)}finally{--e}}};o.set(n)}};return Object.assign(o,s)})();let C;var T=n(8101);const A=(0,T.createContext)(void 0),N=e=>{const t=(0,T.useContext)(A);return(null==e?void 0:e.store)||t||(C||(C=S(),globalThis.__JOTAI_DEFAULT_STORE__||(globalThis.__JOTAI_DEFAULT_STORE__=C),globalThis.__JOTAI_DEFAULT_STORE__!==C&&console.warn("Detected multiple Jotai instances. It may cause unexpected behavior with the default store. https://github.com/pmndrs/jotai/discussions/2044")),C)},M=e=>"function"==typeof(null==e?void 0:e.then),O=e=>{e.status="pending",e.then((t=>{e.status="fulfilled",e.value=t}),(t=>{e.status="rejected",e.reason=t}))},W=T.use||(e=>{if("pending"===e.status)throw e;if("fulfilled"===e.status)return e.value;throw"rejected"===e.status?e.reason:(O(e),e)}),z=new WeakMap,D=e=>{let t=z.get(e);return t||(t=new Promise(((n,r)=>{let o=e;const l=e=>t=>{o===e&&n(t)},s=e=>t=>{o===e&&r(t)},a=e=>{"onCancel"in e&&"function"==typeof e.onCancel&&e.onCancel((r=>{if(r===e)throw new Error("[Bug] p is not updated even after cancelation");M(r)?(z.set(r,t),o=r,r.then(l(r),s(r)),a(r)):n(r)}))};e.then(l(e),s(e)),a(e)})),z.set(e,t)),t};function I(e,t){const n=N(t),[[r,o,l],s]=(0,T.useReducer)((t=>{const r=n.get(e);return Object.is(t[0],r)&&t[1]===n&&t[2]===e?t:[r,n,e]}),void 0,(()=>[n.get(e),n,e]));let a=r;o===n&&l===e||(s(),a=n.get(e));const i=null==t?void 0:t.delay;if((0,T.useEffect)((()=>{const t=n.sub(e,(()=>{if("number"==typeof i){const t=n.get(e);return M(t)&&O(D(t)),void setTimeout(s,i)}s()}));return s(),t}),[n,e,i]),(0,T.useDebugValue)(a),M(a)){const e=D(a);return W(e)}return a}function J(e,t){const n=N(t);return(0,T.useCallback)(((...t)=>{if(!("write"in e))throw new Error("not writable atom");return n.set(e,...t)}),[n,e])}function L(e,t){return[I(e,t),J(e,t)]}var R=n(8233);const B=k(0),F=function(e){const t=k(e,((e,n,r)=>n(t,(0,R.jM)(e(t),"function"==typeof r?r:()=>r))));return t}({name:"Alice",age:25}),U=()=>{console.log("jotai更新了");const[e,t]=L(B),[n,o]=L(F);return(0,r.jsxs)("div",{className:"p-4",children:[(0,r.jsx)("h1",{className:"text-2xl font-bold mb-4",children:"Jotai Demo"}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("h2",{className:"text-lg",children:"计数器"}),(0,r.jsxs)("p",{children:["当前计数: ",e]}),(0,r.jsx)("button",{onClick:()=>t((e=>e+1)),className:"mr-2 px-4 py-2 bg-green-500 text-white rounded hover:bg-green-600",children:"增加"}),(0,r.jsx)("button",{onClick:()=>t((e=>e-1)),className:"mr-2 px-4 py-2 bg-red-500 text-white rounded hover:bg-red-600",children:"减少"}),(0,r.jsx)("button",{onClick:()=>t((e=>e)),className:" px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"保持"})]}),(0,r.jsxs)("div",{className:"mb-4",children:[(0,r.jsx)("h2",{className:"text-lg",children:"用户信息"}),(0,r.jsxs)("p",{children:["姓名: ",n.name]}),(0,r.jsxs)("p",{children:["年龄: ",n.age]}),(0,r.jsxs)("p",{children:["爱好: ",n.likes?.join("---")]}),(0,r.jsx)("button",{onClick:()=>{o((e=>{e.name="阿树"}))},className:"mr-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"更新用户信息"}),(0,r.jsx)("button",{onClick:()=>{o({name:"阿树",age:18})},className:"mr-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"数据直接修改"}),(0,r.jsx)("button",{onClick:()=>{o((e=>{e.name="阿树",e.likes=["打篮球"]}))},className:"mr-4 px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600",children:"属性是复杂类型"})]})]})},P=U;U.whyDidYouRender=!0}}]);